<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Challenges</title>
    <link rel="stylesheet" href="/static/main.css">
    <link rel="stylesheet" href="/static/challenges.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:opsz,wght@8..60,300&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="sidebar">
        <a href="/">Home</a>
        <a href="/challenges" {% if request.path == '/challenges' %}class="true"{% endif %}>Challenges</a>
        <a href="/logout">Log out</a>
    </nav>
    <div id="listOfChallenges" class="challenges-and-button">
        <div class="container">
            <h2>Join challenges!<h2>
            <div class="challenges scrollable-challenges">
                {% for challenge in challenges %}
                <div class="challenge" style="background-color: {{ challenge.color }};">
                    <h3>{{ challenge.title }}</h3>
                    <p/>
                    <p>{{ challenge.description}}</p>
                    <p/>
                    <p>{{ challenge.start_date }} - {{ challenge.end_date }}</p>
                    <p/>
                    {% if challenge in user_joined %}
                    <form action="/leave_challenge" method="POST">
                        <input type="hidden" name="challenge_id" value="{{ challenge.id }}">
                        <button type="submit" class="challenge-button joined" onmouseover="this.innerHTML = 'Leave Challenge'" onmouseout="this.innerHTML = 'Joined!'">Joined!</button>
                    </form>  
                    {% else %}
                    <form action="/join_challenge" method="POST">
                        <input type="hidden" name="challenge_id" value="{{ challenge.id }}">
                        <button type="submit" class="challenge-button">Join Challenge!</button>
                    </form>    
                    {% endif %}            
                </div>
                {% endfor %}
            </div>
        </div>
        <button class="add-challenge-button" id="formButton" onClick="showForm()">Create Challenge</button>
    </div>
    <div id="challengeForm" class="container hidden">
        <form action="/challenges" method="POST">
            <h2>Create challenge!</h2>
            <p>Title:<br>
            <input type="text" class="input" name="title"></p>
            <p>Description:<br>
            <textarea type="text" class="input description-input" name="description"></textarea></p>
            <p>Goal:</p>
            <div>
                <input type="text" class="input" name="goal" placeholder="(e.g. 10,000 steps, read 10 pages, no added sugar) ">
                <select class="input" name="goal_frequency">
                    <option value="day">daily</option>
                    <option value="week">weekly</option>
                    <option value="month">monthly</option>
                </select>
            </div>
            <p>Challenge duration:<br>
                <select class="input" name="duration">
                    <option value="1">one week</option>
                    <option value="2">two weeks</option>
                    <option value="3">three weeks</option>
                    <option value="4">one month</option>
                    <option value="5">two months</option>
                    <option value="6">three months</option>
                    <option value="7">four months</option>
                    <option value="8">six months</option>
                    <option value="9">a year</option>
                </select></p>
            <p>Start date:<br>
            <input type="date" class="input date-input" name="start_date"></p>
            <p>End date:<br>
            <input type="date" class="input date-input" name="end_date"></p>
            <p>Color:<br>
                <div class="colors">
                    <input type="radio" name="color" id="pink" value="#fae7ee">
                    <label class="color pink" for="pink"></label>

                    <input type="radio" name="color" id="yellow" value="#fcfade">
                    <label class="color yellow" for="yellow"></label>

                    <input type="radio" name="color" id="green" value="#e6f8e6">
                    <label class="color green" for="green"></label>

                    <input type="radio" name="color" id="blue" value="#e8e3f3">
                    <label class="color blue" for="blue"></label>

                    <input type="radio" name="color" id="purple" value="#e8e3f3">
                    <label class="color purple" for="purple"></label>
                </div></p>
            <input type="submit" class="button" value="Create">
        </form>
        <button class="button" id="closeFormButton" onClick="closeForm()">Return</button>
    </div>
    <div id="userChallenges">
        {% if challenges %}
        <div class="container">
            <h2>Ongoing Challenges</h2>
            <div class="scrollable-challenges">
                {% for challenge in user_challenges_data %}
                <li>
                    <h3>{{ challenge[1] }}</h3>
                    <ul>
                        Goal: {{ challenge[3] }} {{ challenge[4] }}
                    </ul>
                    <ul>
                        Progress:
                        {% for item in progress %}
                            {% if item[0] == challenge[0] %}
                                {{ item[1] }}
                            {% endif %}
                        {% endfor %}
                        / {{ challenge_durations[challenge[5]] }}
                    </ul>
                </li>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        {% if old_data %}
        <div class="container">
            <h2>Past Challenges</h2>
            <div class="scrollable-challenges">
                {% for challenge in old_data %}
                <li>
                    <h3>{{ challenge[1] }}</h3>
                    <ul>
                        Goal: {{ challenge[3] }} {{ challenge[4] }}
                    </ul>
                    <ul>
                        Result:
                        {% for item in progress %}
                            {% if item[0] == challenge[0] %}
                                {{ item[1] }}
                            {% endif %}
                        {% endfor %}
                        / {{ challenge_durations[challenge[5]] }}
                    </ul>
                    <ul>
                        End date: {{ challenge[7] }}
                    </ul>
                </li>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
    <script>
        function showForm() {
            var form = document.getElementById("challengeForm");
            var list = document.getElementById("listOfChallenges");
            var challenges = document.getElementById("userChallenges");
            form.classList.remove("hidden");
            list.classList.add("hidden");
            challenges.classList.add("hidden");
        }
        function closeForm() {
            var form = document.getElementById("challengeForm");
            var list = document.getElementById("listOfChallenges");
            var challenges = document.getElementById("userChallenges");
            form.classList.add("hidden");
            list.classList.remove("hidden");
            challenges.classList.remove("hidden");
        }
    </script>
</body>
</html>